# 불필요한 객체 생성을 피하라!

### 1. 극단적인 노답 예시

- 똑같은 기능의 객체를 매번 생성하는 거 보다 객체 하나를 재사용하는 편이 나을 때가 많음

```java
String s = new String("bikini"); // 따라 하지 말 것! 
```

- 실행될 때마다 String 인스턴스를 만든다
- 완전 쓸데 없는 행위! 수백만개 만들어질지도,,

<br>

```java
String s = "bikini";
```

- 이게 오백배 낫다
- 매번 인스턴스를 만들지 않고 하나의 인스턴스 사용
- 같은 문자열을 사용하는 코드들이 같은 객체를 재사용하는 것이 보장됨


#
### 2. 생성자 대신 정적 팩터리 메서드(아이템 1)를 사용하기

- 불필요한 객체 생성 피할 수 있으
- Boolean 대신 Boolean.valueOf(String) 팩터리 메서드 사용하기
- 생성자는 호출 시 새로운 객체를 만들지만, 팩터리 메서드는 안그럼!
- 불변 객체뿐만 아니라 가변 객체도 사용중에 변경되지 않음을 안다면 재사용 할 수 있다

#
### 3. 생성 비용이 아주 비싼 객체

- 비싼 객체가 반복해서 필요하다면! 캐싱하여 재사용하길 권장한다
- 안타깝게도 (킹) 자신이 만드는 객체가 비싼지 매번 명확히 알 수는 없다 ㅠㅁㅜ

<br>

```java
static boolean isR(String s){
  return s.matches(...);
}
```

- String.matches는 가장 쉬운 방법이지만 성능이 중요한 상황에서 반복해서 쓰면 안좋다
- 정규표현식용 Pattern 인스턴스는 정규 표현식에 해당하는 유한 상태 머신을 만들기 때문에 인스턴스 생성 비용이 높다

<br>

  성능 개선을 위해서는 패턴 인스턴스를 클래스 초기화(생성) 과정에서 직접 생성해 캐싱해두고 재사용하자!
 
 <br>
 
 ```java
 public class R{
  private static final Pattern ROMAN = Pattern.compile(...);
  
  static boolean isR(String s){
    return ROMAN.matcher(s).matches();
  }
 }
 ```
 
- 성능 개선, 코드 명확 짱이군
- 초기화할 떄 메서드를 만들고 호출 안한다면 그것도 낭비일 수 있다
- 메서드가 호출될 때 초기화 시키는 지연 초기화 방법도 있지만 권하지는 않는당

- 코드를 복잡하게 만들고 성능은 크게 개선되지 않기 때문!

#
### 4. 어댑터

- 재사용해도 안전한게 명백함
- 하지만 덜 명확하거나 직관에 반대되는 상황도 있음 `???(너무 번역체임)`

`keySet이 여러개 개체를 반환할 줄 알았지~? 사실 하나만 반환하지롱 -> 니 직관이랑 다르지 라는 뜻`

<br>

- 어뎁터 : 실제 작업은 뒷단 객체에 위임하고 자신은 제 2의 인터페이스 역할을 해주는 객체

- 어뎁터는 뒷단 객체만 관리해주면 됨

- 뒷단 객체당 하나의 어뎁터가 있으면 됨

<br>

- Map 인터체이스의 keySet 메서드는 키를 전부 다 담은 Set을 반환함

- 매번 같은 Set 인스턴스를 반환할지도 모름
- 반환된 인스턴스가 가변이더라도 기능적으로는 모두 똑같음
- 반환한 객체 중 하나를 수정하면 모두 바껴!
- 그래서 keySet이 뷰 객체를 여러개 만들 필요도 이득도 없다!

<br>

#
### 5. 불필요한 객체를 만드는 또 다른 예시 - 오토박싱

- 프로그래머가 기본 타입과 박싱된 기본 타입을 섞어 쓸 때 자동으로 상화 변환해주는 기술
- 기본타입과 그에 대응하는 박싱된 기본 타입의 구분을 흐려줌 BUT 완전히 없애주진 않음!

<br>

```java
private static long sum(){
  Long sum = 0L;
  for(long i=0;i<=Integer.MAX_VALUE;i++){
    sum+=i;
  }
  
  return sum;
}
```

- 양의 정수의 총합을 구하기 위해 long 사용
- sum을 long으로 선언해야지!! (노 객체)
- 박싱된 기본 타입 보다는 기본 타입을 사용하자!

#
### 6. 주목
- 객체 생성을 무조건 줄이자는게 아님

- 요즘 JVM은 일 잘해서 작은 객체는 괜찮음
- 명확성, 간결성, 기능을 위해서는 객체 추가 환영!

<br>

- 아주 무거운 객체가 아니고서야 단순히 객체 피하려고 잘못하지 말자
- DB 연결 같은건 재사용 해주자! (무거운 객체)

- 코드 괜히 헷갈리게 만들지 말고 가벼운 객체는 그냥 두자






