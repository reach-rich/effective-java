## ê³µìœ  ì¤‘ì¸ ê°€ë³€ ë°ì´í„°ëŠ” ë™ê¸°í™”í•´ ì‚¬ìš©í•˜ë¼

#
### ë™ê¸°í™”ë€?
> synchronized í‚¤ì›Œë“œëŠ” í•´ë‹¹ ë©”ì„œë“œë‚˜ ë¸”ë¡ì„ í•œë²ˆì— í•œ ìŠ¤ë ˆë“œì”© ìˆ˜í–‰í•˜ë„ë¡ ë³´ì¥í•œë‹¤. (ë™ê¸°í™”)

- ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ë³€ê²½ ì¤‘ì´ì–´ì„œ ì¼ê´€ë˜ì§€ ì•Šì€ ìˆœê°„ì˜ ê°ì²´ë¥¼ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ë³´ì§€ ëª»í•˜ê²Œ ë§‰ëŠ” ê²ƒ
  - ë½ì„ ê±¸ì–´ì„œ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ë³´ì§€ ëª»í•˜ê²Œ ë§‰ëŠ” ê²ƒ (ì¼ê´€ì„±ì´ ê¹¨ì§„ ìƒíƒœë¥¼ ë³¼ ìˆ˜ ì—†ìŒ)
- ë™ê¸°í™”ëœ ë©”ì„œë“œë‚˜ ë¸”ë¡ì— ë“¤ì–´ê°„ ìŠ¤ë ˆë“œê°€ ê°™ì€ ë½ì˜ ë³´í˜¸í•˜ì— ìˆ˜í–‰ëœ ëª¨ë“  ì´ì „ ìˆ˜ì •ì˜ ìµœì¢… ê²°ê³¼ë¥¼ ë³´ê²Œ í•´ì£¼ëŠ” ê²ƒ

#
### ë™ê¸°í™”ê°€ í•„ìš”í•œ ì´ìœ 
- long, double ì™¸ì˜ ë³€ìˆ˜ë¥¼ ì½ê³  ì“°ëŠ” ë™ì‘ì€ ì›ìì 
- ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ í•œ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•´ë„ í•­ìƒ ì •ìƒì ìœ¼ë¡œ ì €ì¥í•œ ê°’ì„ ì˜¨ì „íˆ ì½ì–´ì˜´ì„ ë³´ì¥
- í•˜ì§€ë§Œ 'ìˆ˜ì •ì´ ì™„ì „íˆ ë°˜ì˜ëœ' ê°’ì€ ë³´ì¥í•´ì£¼ì§€ë§Œ í•´ë‹¹ ê°’ì´ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ê²Œ ë³´ì´ëŠ”ê°€ëŠ” ë³´ì¥í•´ì£¼ì§€ ì•ŠìŒ

> __ë™ê¸°í™”ëŠ” ë°°íƒ€ì  ì‹¤í–‰ë¿ ì•„ë‹ˆë¼ ìŠ¤ë ˆë“œ ì‚¬ì´ì˜ ì•ˆì •ì ì¸ í†µì‹ ì— ê¼­ í•„ìš”í•˜ë‹¤__

#### ê¸°ë³¸í˜• íƒ€ì…ì´ ì›ìì ì¸ ì´ìœ   
> JVMì€ ë°ì´í„°ë¥¼ 4ë°”ì´íŠ¸(32ë¹„íŠ¸) ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•œë‹¤.
> 
> int ë³´ë‹¤ ì‘ì€ íƒ€ì… : í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¡œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì—, í•œ ìŠ¤ë ˆë“œë¡œë§Œ ì²˜ë¦¬ëœë‹¤(ì‘ì—…ì˜ ìµœì†Œ ë‹¨ìœ„).
> long, double : 8 ë°”ì´íŠ¸ë¥¼ ë„˜ì–´ê°€ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê°œì…ë  ì—¬ì§€ê°€ ìƒê²¨ ì›ìì ì´ë¼ í•  ìˆ˜ ì—†ë‹¤.

#
### ë‹¤ë¥¸ ìŠ¤ë ˆë“œë¥¼ ë©ˆì¶”ëŠ” ë²•

- ìš°ì„  Thread.stopì€ ì‚¬ìš©í•˜ì§€ ë§ì : ë°ì´í„°ê°€ í›¼ì†ë  ìˆ˜ ìˆë‹¤ (ìë°” 11ì—ì„œë¶€í„°ëŠ” ì œê±°ë¨)

```java
// boolean í•„ë“œë¥¼ í™œìš©í•œ ì˜ëª»ëœ ì½”ë“œ
public class StopThread {
	private static boolean stopRequested;
    
  public static void main(String[] args) throws InterruptedException {
    Thread th = new Thread(() -> {
        int i = 0;
          while (!stopRequested) {
            i++;
          }
      });
      th.start();
      
      TimeUnit.SECONDS.sleep(1);
      stopRequested = true;
  }
}
```
```java
// JVMì˜ ìµœì í™”ëœ ì½”ë“œ
if (!stopRequested)  // ëŒì–´ì˜¬ë¦¬ê¸°(ìµœì í™” ê¸°ëŠ¥) : ì‘ë‹µ ë¶ˆê°€ ìƒíƒœê°€ ëŒ
	while (true)
    	i++;
```
- `stopRequested` í•„ë“œê°€ ë™ê¸°í™” ë˜ì§€ ì•Šì•„ ë¬´í•œë£¨í”„ì— ë¹ ì§„ë‹¤
> JVMì˜ ìµœì í™”ëœ ì½”ë“œì—ì„œ ë©”ì¸ ìŠ¤ë ˆë“œê°€ ìˆ˜ì •í•œ true ê°’ì´ ë°˜ì˜ë˜ê¸° ì´ì „ ê·¸ ì§§ì€ ì‹œê°„ ì‚¬ì´ì— stopRequested í•„ë“œë¥¼ ì½ì–´ì™€ ë²„ë ¸ë‹¤ë©´,
> ifë¬¸ì´ ì´ë¯¸ false ê°€ ë˜ì—ˆê¸° ë•Œë¬¸ì— ì‘ë‹µ ë¶ˆê°€ ìƒíƒœê°€ ëœë‹¤

#
### ğŸ¶ ì˜¬ë°”ë¥´ê²Œ ì¢…ë£Œí•˜ëŠ” ë°©ë²• : synchronized
```java
public class StopThread {
	private static boolean stopRequested;
  private static synchronized void requestStop() { // ì“°ê¸°
     stopRequested = true;
  }

  private static synchronized boolean stopRequested() { // ì½ê¸°
    return stopRequested;
  }

  public static void main(String[] args) throws InterruptedException {
    Thread th = new Thread(() -> {
        int i = 0;
          while (!stopRequested()) {
            i++;
          }
      });
      th.start();
      
      TimeUnit.SECONDS.sleep(1);
      requestStop();
  }
}
```
- ì“°ê¸° ë©”ì„œë“œì™€ ì½ê¸° ë©”ì„œë“œë¥¼ ëª¨ë‘ ë™ê¸°í™”í•´ ìŠ¤ë ˆë“œê°€ 1ì´ˆ ë’¤ ì¢…ë£Œë¨

#
### ğŸ¶ ì†ë„ê°€ ë” ë¹ ë¥¸ ëŒ€ì•ˆ : volatile
- stopRequested í•„ë“œë¥¼ volatileë¡œ ì„ ì–¸í•˜ê¸°
- volatile í•œì •ìëŠ” ë°°íƒ€ì  ìˆ˜í–‰ê³¼ëŠ” ìƒê´€ì—†ì§€ë§Œ í•­ìƒ ê°€ì¥ ìµœê·¼ì— ê¸°ë¡ëœ ê°’ì„ ì½ê²Œë¨ì„ ë³´ì¥

> volatile ì´ë€, ê³µìœ  ë³€ìˆ˜ë¥¼ ìºì‹œê°€ ì•„ë‹Œ ë©”ì¸ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ê² ë‹¤ë¼ê³  ëª…ì‹œí•˜ëŠ” í‚¤ì›Œë“œì´ë‹¤.
> ì°¸ê³ ë¡œ í•´ë‹¹ í‚¤ì›Œë“œê°€ ì„ ì–¸ëœ ë³€ìˆ˜ê°€ ìˆëŠ” ì½”ë“œëŠ” ìµœì í™”ë˜ì§€ ì•ŠëŠ”ë‹¤.

```java
public class StopThread {
	private static volatile boolean stopRequested;
    ...
}
```

- í•˜ì§€ë§Œ ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ, ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ì“°ê¸° ì—°ì‚°ì„ í•˜ëŠ” ê²½ìš°ì—ëŠ” ì í•©í•˜ì§€ ì•Šë‹¤

> ì°¸ê³  ë‚´ìš© : https://velog.io/@semi-cloud/Java-ì•„ì´í…œ-78-ê³µìœ -ì¤‘ì¸-ê°€ë³€-ë°ì´í„°ëŠ”-ë™ê¸°í™”í•´-ì‚¬ìš©í•˜ë¼

```java
private static volatile int nextNubmer = 0;

public static int generateNumber() {
	return nextNumber++;
}
```
1. ìŠ¤ë ˆë“œ1ì´ ë©”ì¸ ë©”ëª¨ë¦¬ ë³€ìˆ˜ ê°’ì„ ì½ì–´ì˜¤ê³ , 1 ì¦ê°€ì‹œí‚¨ë‹¤.
2. ìŠ¤ë ˆë“œ2ê°€ ìŠ¤ë ˆë“œ1ì´ ë³€ê²½ì‹œí‚¨ ê°’ì´ ë©”ì¸ ë©”ëª¨ë¦¬ì— ë°˜ì˜ ë˜ê¸° ì „ì— ë³€ìˆ˜ ê°’ì„ ì½ì–´ì˜¤ê³ , 1 ì¦ê°€ì‹œí‚¨ë‹¤.
3. ë‘˜ ë‹¤ ë³€ìˆ˜ 0 ì¼ë•Œì˜ ìƒíƒœì—ì„œ 1 ì„ ì¦ê°€ì‹œì¼°ìœ¼ë¯€ë¡œ 2 ê°€ ì•„ë‹Œ 1 ì´ ìµœì¢…ì ìœ¼ë¡œ ë°˜ì˜ë˜ë²„ë¦°ë‹¤.

> ì´ì²˜ëŸ¼ volatileì€ ê³µìœ  ë¸”ë¡ì— í•œë²ˆì— í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë§‰ì§€ ëª»í•œë‹¤.  

> ë”°ë¼ì„œ ì´ëŸ° ê²½ìš°, volatile ì„ ì œê±°í•˜ê³  synchronized ë¥¼ ë¶™ì—¬ì„œ ë™ì‹œì— í˜¸ì¶œí•´ë„ ì„œë¡œ ê°„ì„­í•˜ì§€ ì•ŠëŠ” ìƒíƒœì—ì„œ ì´ì „ í˜¸ì¶œì´ ë³€ê²½í•œ ê°’ì„ ì½ì–´ì˜¬ ìˆ˜ ìˆë‹¤.
> ì•ì„  StopThread ì˜ˆì œì—ì„œ volatile ì‚¬ìš©ì´ ê°€ëŠ¥í–ˆë˜ ì´ìœ ëŠ”, ì˜¤ì§ ìŠ¤ë ˆë“œ í•˜ë‚˜ë§Œ stopRequested ê³µìœ  ë³€ìˆ˜ì— ì“°ê¸° ì—°ì‚°ì„ í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì´ë‹¤.

#
### ğŸ¶ ë½-í”„ë¦¬ ì•ˆì „í•œ í´ë˜ìŠ¤ : AtomicLong
- `java.util.concurrent.atomic` íŒ¨í‚¤ì§€ì˜ AtomicLong ì„ ì‚¬ìš©í•˜ë©´ ë©€í‹° ìŠ¤ë ˆë”© í™˜ê²½ì—ì„œ ë½ ì—†ì´ë„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

private static final AtomicLong nextNum = new AtomicLong();

public static long generateNumber() {
	return nextNum.getAndIncrement();

