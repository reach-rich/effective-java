Effective Java의  61번째 아이템 "박싱된 기본 타입보다는 기본 타입을 사용하라"를 읽고 정리한 내용을 포스팅합니다.

<br>

## 1. 기본 타입과 박싱된 기본 타입

자바의 데이터 타입은 크게 두 가지로 나눌 수 있다. 

* 기본 타입 : int, double, boolean, ...
* 참조 타입 : Integer, Double, Boolean, String, List, ...

기본 타입에 대응하는 참조 타입이 하나씩 있으며, 이를 박싱된 기본 타입이라고 한다.



오토박싱과 오토언박싱 덕분에 두 타입을 크게 구분하지 않고 사용할 수는 있지만, 그렇다고 차이가 사라지는 것은 아니기 때문에 주의해서 사용해야 한다. 주된 차이는 크게 세 가지가 있다.

1. 기본 타입은 값만 가지고 있으나, 박싱된 기본 타입은 값에 더해 식별성이란 속성을 갖는다.
   * 두 인스턴스는 값이 같아도 서로 다르다고 식별될 수 있다.
2. 기본 타입의 값은 언제나 유효하나, 박싱된 기본 타입은 유효하지 않은 값, 즉 null을 가질 수 있다. 
3. 기본 타입이 박싱된 기본 타입보다 시간과 메모리 사용면에서 더 효율적이다.

<br>

## 2. 잘못된 사용 예제

### 1) 두 인스턴스 비교

다음은 Integer 값을 오름차순으로 정렬하는 비교자다.

```java
Comparator<Integer> naturalOrder = (i, j) -> (i < j) ? -1 : (i == j ? 0 : 1);
```

별다른 문제를 찾기 어렵고, 실제로 이것저것 테스트해봐도 잘 통과한다. 하지만 심각한 결함이 있다. `naturalOrder.compare(new Integer(42), new Integer(42))`를 실행해보자. 값이 0으로 같기 때문에 0을 출력해야 하지만, 실제로는 1을 출력한다. 

원인이 뭘까? naturalOrder의 첫 번째 검사 (i < j)는 잘 작동한다. 여기서 i와 j가 참조하는 Integer는 기본 타입 값으로 변환된다. 그러나 (i == j)에서는 두 객체의 식별성을 검사하게 된다. i와 j가 서로 다른 인스턴스라면 비교의 결과는 false가 된다. 

이처럼 박싱된 기본 타입에 == 연산자를 사용하면 오류가 일어난다. 문제를 해결하려면 아래와 같이 수정하면 된다.

```java
Comparator<Integer> naturalOrder = (iBoxed, jBoxed) -> {
	int i = iBoxed, j = jBoxed;
  return i < j ? -1 : (i == j ? 0 : 1);
}
```

<br>

### 2) NullPointerException 문제

```java
public class Unbelievable {
  static Integer i;
  
  public static void main(String[] args) {
    if (i == 42) System.out.println("믿을 수 없군!");
  }
}
```

이 프로그램은 i == 42를 검사할 때 NullPointerException이 발생한다. 원인은 i가 int가 아닌 Integer이며, null로 초기화되기 때문이다. 거의 예외 없이 기본 타입과 박싱된 기본 타입을 혼용한 연산에서는 박싱된 기본 타입의 박싱이 자동으로 풀린다. 그리고 null 참조를 언박싱하면 NullPointerException이 발생한다. 

<br>

### 3) 성능 문제

```java
public static main(String[] args) {
  Long sum = 0L;
  for (long i = 0; i <= Integer.MAX_VALUE; i++) {
    sum += i;
  }
  System.out.println(sum);
}
```

이 프로그램은 지역변수 sum을 박싱된 기본 타입으로 선언하여 느려졌다. 오류나 경고 없이 컴파일되지만, 박싱과 언박싱이 반복해서 일어나 체감이 될 정도로 느려진다. 

<br>

## 3. 적절한 사용처

1. 컬렉션의 원소, 키, 값으로 사용한다.
   * 컬렉션은 기본 타입을 담을 수 없다.
2. 매개변수화 타입이나 매개변수화 메서드의 타입 매개변수로 사용한다.
   * 자바 언어는 타입 매개변수로 기본 타입을 지원하지 않는다.
3. 리플렉션을 통해 메서드를 호출할 때 사용한다.

<br>

## 4. 핵심 정리

* 기본 타입과 박싱된 기본 타입 중 하나를 선택해야 한다면 가능하면 기본 타입을 사용하라.
* 오토박싱이 박싱된 기본 타입을 사용할 때의 번거로움을 줄여주지만, 그 위험까지 없애주지는 않는다.
* 두 박싱된 기본 타입을 == 연산자로 비교한다면 식별성 비교가 이뤄지는데, 이는 여러분이 원한 게 아닐 가능성이 크다.
* 같은 연산에서 기본 타입과 박싱된 기본 타입을 혼용하면 언박싱이 이뤄지며, 언박싱 과정에서 NullPointerException을 던질 수 있다.
* 기본 타입을 박싱하는 작업은 필요 없는 객체를 생성하는 부작용을 낳을 수 있다.
